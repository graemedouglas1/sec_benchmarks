#TRUSTED 6f27eb081eeec41951b9313b7820beed253d2c2b7bab3e4b75e97e8b6bc175a32b02798956f12dba268f927be9bb76abf896bebfa9a3f5a8f8f4e19129f9d609c65b05449cdf0aefc903505679b778831529732a173469a0b9bf83ba5ea4c2306178ebbdb4995389376933a0870e9638f92902ae897951017ec3e593f48ba1294d3e1db667bc499d27d4701839e85117bd5ed4a8b59c5784635dd2e89835484fb30c8bbce0d574bc9e6ed680220535d2068e9ae6e24993e2cba3cbaf3b8bb7fee67a3f95575c2e6480a6420a1732928dad2242bae65fa65482f2c8a478ed58aade2c9f27c682a6e32e89fcfa2ba7fa297443f71e016b9c15f0d34f529b073bbe0b8a2ceb2c003fb4a645944639986b3ebbfa7dc9de1ab98911576263acd8866caeb6bf10ccc1a2b77a55d6d074b688b4ad00fe0584e7d56b587d81a03d41fb453b4f66e78ea997e2d2c6c76e4f4d5dc12de5b263200e77291177b16a0aff4618e32fce1a6a349cfb5cca2e8790d7b51d489d088e370bc2ae439b2094f4ef80d25aca9bf5cccd034037cb8815d8fcec9674e3f13b7b9199bd1e031a6f85fe814531aca45902a506d9ac8e76e7952135c52784700f203406a3b032366b8a96d04b65fa4752058c42fd9cdb144825e783c691f81facf6ceb41f523ca7db20c0c3d38fe52646884f1e92aaa0cda822339a15e8c1431d83d363d70e0b447705e0a6c1
#TRUST-RSA-SHA256 0a649afbc04977ab48f41f35e0fa2eb70e6a9369a3d7c3c5509b1a42f1e971d4fe5d3324f962945396ca3b9349978bc7ac34321d9e624524e3e980e82461a9d698d905ebf2042004b465b378665b5b3509c236d8bf1bf285106efddaca621f944c8a33d9301fca7aa29a05f8ac408088ca9641f6418a2edc7ff3094345c93b46b19cb8022b237024bdb2378d72e52855cf7c5533590a2c47a27d8eccb13d94b36b662947372424c0690b92e937963384b73504c99c6de7842507a1cc25d3b646b3735a415df3313fd2cf572801e823b56628d448ed1850f8c64d5fc60e21f5968b2d58c07e58a80640281521b5bac745b762bd7bcc38801d454de1bd86f80c4a16344a8d09896895e0f7b59238bde844529d71affe90853d4f22e09c66c60c894be98a92f44fb916aaa6614cc949ec67ddf34109410696df24cc4098025e9eda57f2ab0916a4760f78e9b03fa82ad7a1daeb13982fbc9942d2be5e089b2d202c435adaec4805ff961ecfcadcd26ebbd6b0f0b8456ea970b79dfa202ac93370b1b90c7b894b1acb99ddef493af7bde41101e0cbe822500dfe84a5d7cab2509e8eb6cf2d09ff045915fcc442eff02ef8eae4160e6c9dd0545b7393bfab1cc035eac1fa1e8f1182490bb15f9491df3a3d1320292459661eeca6e25d7b716fdcae7f437cf59f9df6014eaaa23c7f47a76106d47fb2c12338ce6e10474410d8f21850
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.1 $
# $Date: 2024/06/17 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA Microsoft Windows Defender Firewall with Advanced Security v2r2 STIG.
#
#<ui_metadata>
#<display_name>DISA Microsoft Windows Firewall v2r2</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>Microsoft Windows Firewall</name>
#  <version>2.2.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip</link>
#</spec>
#<labels>windows_firewall,disa,update_20230227</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"Windows Firewall">

<if>
  <condition type:"AND">
    <custom_item>
      type        : REG_CHECK
      description : "Windows is installed"
      value_type  : POLICY_TEXT
      value_data  : "HKLM\SOFTWARE\Microsoft\Windows NT"
      reg_option  : MUST_EXIST
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "DISA_STIG_Windows_Firewall_v2r2.audit from DISA Microsoft Windows Defender Firewall with Advanced Security v2r2 STIG"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
    </report>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Enablefirewall Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_option  : MUST_EXIST
          key_item    : "EnableFirewall"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000001 - Windows Defender Firewall with Advanced Security must be enabled when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to the domain."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241989r922928_rule,STIG-ID|WNFWA-000001,STIG-Legacy|SV-54833,STIG-Legacy|V-17415,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241989"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000001 - Windows Defender Firewall with Advanced Security must be enabled when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to the domain."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241989r922928_rule,STIG-ID|WNFWA-000001,STIG-Legacy|SV-54833,STIG-Legacy|V-17415,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241989"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Enablefirewall Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_option  : MUST_EXIST
          key_item    : "EnableFirewall"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000002 - Windows Defender Firewall with Advanced Security must be enabled when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to a private network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241990r922930_rule,STIG-ID|WNFWA-000002,STIG-Legacy|SV-54849,STIG-Legacy|V-17416,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241990"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000002 - Windows Defender Firewall with Advanced Security must be enabled when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to a private network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241990r922930_rule,STIG-ID|WNFWA-000002,STIG-Legacy|SV-54849,STIG-Legacy|V-17416,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241990"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Enablefirewall Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_option  : MUST_EXIST
          key_item    : "EnableFirewall"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000003 - Windows Defender Firewall with Advanced Security must be enabled when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to a public network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241991r922932_rule,STIG-ID|WNFWA-000003,STIG-Legacy|SV-54855,STIG-Legacy|V-17417,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241991"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000003 - Windows Defender Firewall with Advanced Security must be enabled when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. This setting enables the firewall when connected to a public network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Firewall state' to 'On (recommended)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile state on'.
or
'Netsh advfirewall set allprofiles state on'."
          reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-241991r922932_rule,STIG-ID|WNFWA-000003,STIG-Legacy|SV-54855,STIG-Legacy|V-17417,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-241991"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile"
          reg_item    : "EnableFirewall"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Defaultinboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultInboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000004 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked in the domain."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-241992r922934_rule,STIG-ID|WNFWA-000004,STIG-Legacy|SV-54859,STIG-Legacy|V-17418,SWIFT-CSCv1|2.3,Vuln-ID|V-241992"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000004 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked in the domain."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-241992r922934_rule,STIG-ID|WNFWA-000004,STIG-Legacy|SV-54859,STIG-Legacy|V-17418,SWIFT-CSCv1|2.3,Vuln-ID|V-241992"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Defaultoutboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultOutboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000005 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed in the domain, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-241993r922936_rule,STIG-ID|WNFWA-000005,STIG-Legacy|SV-54863,STIG-Legacy|V-17419,Vuln-ID|V-241993"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000005 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed in the domain, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-241993r922936_rule,STIG-ID|WNFWA-000005,STIG-Legacy|SV-54863,STIG-Legacy|V-17419,Vuln-ID|V-241993"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging\Logfilesize Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogFileSize"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000009 - Windows Defender Firewall with Advanced Security log size must be configured for domain connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a domain connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Size limit (KB):' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241994r922938_rule,STIG-ID|WNFWA-000009,STIG-Legacy|SV-54874,STIG-Legacy|V-17425,Vuln-ID|V-241994"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000009 - Windows Defender Firewall with Advanced Security log size must be configured for domain connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a domain connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Size limit (KB):' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241994r922938_rule,STIG-ID|WNFWA-000009,STIG-Legacy|SV-54874,STIG-Legacy|V-17425,Vuln-ID|V-241994"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging\Logdroppedpackets Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogDroppedPackets"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000010 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a domain connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241995r922940_rule,STIG-ID|WNFWA-000010,STIG-Legacy|SV-54877,STIG-Legacy|V-17426,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-241995"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000010 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a domain connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241995r922940_rule,STIG-ID|WNFWA-000010,STIG-Legacy|SV-54877,STIG-Legacy|V-17426,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-241995"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging\Logsuccessfulconnections Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogSuccessfulConnections"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000011 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a domain connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Log successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241996r922942_rule,STIG-ID|WNFWA-000011,STIG-Legacy|SV-54878,STIG-Legacy|V-17427,SWIFT-CSCv1|6.4,Vuln-ID|V-241996"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Domainprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000011 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a domain."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a domain connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Domain Profile tab >> Logging (select Customize), 'Log successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set domainprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241996r922942_rule,STIG-ID|WNFWA-000011,STIG-Legacy|SV-54878,STIG-Legacy|V-17427,SWIFT-CSCv1|6.4,Vuln-ID|V-241996"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Domainprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Defaultinboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultInboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000012 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked on a private network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-241997r922944_rule,STIG-ID|WNFWA-000012,STIG-Legacy|SV-54879,STIG-Legacy|V-17428,SWIFT-CSCv1|2.3,Vuln-ID|V-241997"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000012 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked on a private network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-241997r922944_rule,STIG-ID|WNFWA-000012,STIG-Legacy|SV-54879,STIG-Legacy|V-17428,SWIFT-CSCv1|2.3,Vuln-ID|V-241997"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Defaultoutboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultOutboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000013 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed on a private network, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-241998r922946_rule,STIG-ID|WNFWA-000013,STIG-Legacy|SV-54890,STIG-Legacy|V-17429,Vuln-ID|V-241998"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000013 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed on a private network, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-241998r922946_rule,STIG-ID|WNFWA-000013,STIG-Legacy|SV-54890,STIG-Legacy|V-17429,Vuln-ID|V-241998"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging\Logfilesize Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogFileSize"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000017 - Windows Defender Firewall with Advanced Security log size must be configured for private network connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a private connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Size limit (KB)' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241999r922948_rule,STIG-ID|WNFWA-000017,STIG-Legacy|SV-54903,STIG-Legacy|V-17435,Vuln-ID|V-241999"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000017 - Windows Defender Firewall with Advanced Security log size must be configured for private network connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a private connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Size limit (KB)' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-241999r922948_rule,STIG-ID|WNFWA-000017,STIG-Legacy|SV-54903,STIG-Legacy|V-17435,Vuln-ID|V-241999"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging\Logdroppedpackets Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogDroppedPackets"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000018 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a private network connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242000r922950_rule,STIG-ID|WNFWA-000018,STIG-Legacy|SV-54904,STIG-Legacy|V-17436,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-242000"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000018 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a private network connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242000r922950_rule,STIG-ID|WNFWA-000018,STIG-Legacy|SV-54904,STIG-Legacy|V-17436,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-242000"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging\Logsuccessfulconnections Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogSuccessfulConnections"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000019 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a private network connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Logged successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242001r922952_rule,STIG-ID|WNFWA-000019,STIG-Legacy|SV-54905,STIG-Legacy|V-17437,SWIFT-CSCv1|6.4,Vuln-ID|V-242001"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Privateprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000019 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a private network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a private network connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Private Profile tab >> Logging (select Customize), 'Logged successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set privateprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242001r922952_rule,STIG-ID|WNFWA-000019,STIG-Legacy|SV-54905,STIG-Legacy|V-17437,SWIFT-CSCv1|6.4,Vuln-ID|V-242001"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Standardprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Defaultinboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultInboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000020 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked on a public network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-242002r922954_rule,STIG-ID|WNFWA-000020,STIG-Legacy|SV-54906,STIG-Legacy|V-17438,SWIFT-CSCv1|2.3,Vuln-ID|V-242002"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000020 - Windows Defender Firewall with Advanced Security must block unsolicited inbound connections when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Unsolicited inbound connections may be malicious attempts to gain access to a system. Unsolicited inbound connections, for which there is no rule allowing the connection, will be blocked on a public network."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Inbound connections' to 'Block (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-242002r922954_rule,STIG-ID|WNFWA-000020,STIG-Legacy|SV-54906,STIG-Legacy|V-17438,SWIFT-CSCv1|2.3,Vuln-ID|V-242002"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile"
          reg_item    : "DefaultInboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Defaultoutboundaction Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_option  : MUST_EXIST
          key_item    : "DefaultOutboundAction"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000021 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed on a public network, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-242003r922956_rule,STIG-ID|WNFWA-000021,STIG-Legacy|SV-54908,STIG-Legacy|V-17439,Vuln-ID|V-242003"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000021 - Windows Defender Firewall with Advanced Security must allow outbound connections, unless a rule explicitly blocks the connection when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Outbound connections are allowed on a public network, unless a rule explicitly blocks the connection. This allows normal outbound communication, which could be restricted as necessary with additional rules."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> State, 'Outbound connections' to 'Allow (default)'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile firewallpolicy blockinbound,allowoutbound'.
or
'Netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound'.

Both inbound and outbound parameters must be specified to execute this command."
          reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-242003r922956_rule,STIG-ID|WNFWA-000021,STIG-Legacy|SV-54908,STIG-Legacy|V-17439,Vuln-ID|V-242003"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 0
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile"
          reg_item    : "DefaultOutboundAction"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "WNFWA-000024 - Windows Defender Firewall with Advanced Security local firewall rules must not be merged with Group Policy settings when connected to a public network."
      info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Local firewall rules will not be merged with Group Policy settings on a public network to prevent Group Policy settings from being changed."
      solution    : "If the system is not a member of a domain, this is NA.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Settings (select Customize) >> Rule merging, 'Apply local firewall rules:' to 'No'."
      reference   : "800-53|SC-24,800-53r5|SC-24,CAT|II,CCI|CCI-001190,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-24,ITSG-33|SC-24a.,QCSC-v1|5.2.1,Rule-ID|SV-242004r922958_rule,STIG-ID|WNFWA-000024,STIG-Legacy|SV-54917,STIG-Legacy|V-17442,Vuln-ID|V-242004"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
      value_type  : POLICY_DWORD
      value_data  : 0
      reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
      reg_item    : "AllowLocalPolicyMerge"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "WNFWA-000025 - Windows Defender Firewall with Advanced Security local connection rules must not be merged with Group Policy settings when connected to a public network."
      info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Local connection rules will not be merged with Group Policy settings on a public network to prevent Group Policy settings from being changed."
      solution    : "If the system is not a member of a domain, this is NA.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Settings (select Customize) >> Rule merging, 'Apply local connection security rules:' to 'No'."
      reference   : "800-53|SC-24,800-53r5|SC-24,CAT|II,CCI|CCI-001190,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-24,ITSG-33|SC-24a.,QCSC-v1|5.2.1,Rule-ID|SV-242005r922960_rule,STIG-ID|WNFWA-000025,STIG-Legacy|SV-54918,STIG-Legacy|V-17443,Vuln-ID|V-242005"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
      value_type  : POLICY_DWORD
      value_data  : 0
      reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile"
      reg_item    : "AllowLocalIPsecPolicyMerge"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging\Logfilesize Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogFileSize"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000027 - Windows Defender Firewall with Advanced Security log size must be configured for public network connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a public network connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Size limit (KB)' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242006r922962_rule,STIG-ID|WNFWA-000027,STIG-Legacy|SV-54921,STIG-Legacy|V-17445,Vuln-ID|V-242006"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000027 - Windows Defender Firewall with Advanced Security log size must be configured for public network connections."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. The firewall log file size for a public network connection will be set to ensure enough capacity is allocated for audit data."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall with Advanced Security >> Microsoft Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Size limit (KB)' to '16,384' or greater.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh command may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging maxfilesize 16384' or greater."
          reference   : "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|III,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242006r922962_rule,STIG-ID|WNFWA-000027,STIG-Legacy|SV-54921,STIG-Legacy|V-17445,Vuln-ID|V-242006"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : [16384..MAX]
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile\Logging"
          reg_item    : "LogFileSize"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging\Logdroppedpackets Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogDroppedPackets"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000028 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a public network connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242007r922964_rule,STIG-ID|WNFWA-000028,STIG-Legacy|SV-54922,STIG-Legacy|V-17446,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-242007"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000028 - Windows Defender Firewall with Advanced Security must log dropped packets when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of dropped packets for a public network connection will be enabled to maintain an audit trail of potential issues."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Log dropped packets' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging droppedconnections enable'.
or
'Netsh advfirewall set allprofiles logging droppedconnections enable'."
          reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|III,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242007r922964_rule,STIG-ID|WNFWA-000028,STIG-Legacy|SV-54922,STIG-Legacy|V-17446,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-242007"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile\Logging"
          reg_item    : "LogDroppedPackets"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : REG_CHECK
          description : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging\Logsuccessfulconnections Exists"
          value_type  : POLICY_TEXT
          value_data  : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_option  : MUST_EXIST
          key_item    : "LogSuccessfulConnections"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000029 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a public network connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Logged successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242008r922966_rule,STIG-ID|WNFWA-000029,STIG-Legacy|SV-54923,STIG-Legacy|V-17447,SWIFT-CSCv1|6.4,Vuln-ID|V-242008"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\Software\Policies\Microsoft\Windowsfirewall\Publicprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : REGISTRY_SETTING
          description : "WNFWA-000029 - Windows Defender Firewall with Advanced Security must log successful connections when connected to a public network."
          info        : "A firewall provides a line of defense against attack. To be effective, it must be enabled and properly configured. Logging of successful connections for a public network connection will be enabled to maintain an audit trail if issues are discovered."
          solution    : "The preferred method of configuring the firewall settings is with a policy, particularly in a domain environment.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall with Advanced Security >> Windows Defender Firewall Properties (this link will be in the right pane) >> Public Profile tab >> Logging (select Customize), 'Logged successful connections' to 'Yes'.

In addition to using policies, systems may also be configured using the firewall GUI or Netsh commands. These methods may be more appropriate for standalone systems.

The configuration settings in the GUI are the same as those specified in the policy above. Microsoft Defender Firewall Properties will be a link in the center pane after opening Microsoft Defender Firewall with Advanced Security.

The following Netsh commands may also be used to configure this setting:

'Netsh advfirewall set publicprofile logging allowedconnections enable'.
or
'Netsh advfirewall set allprofiles logging allowedconnections enable'."
          reference   : "800-53|AU-14(2),800-53r5|AU-14,CAT|III,CCI|CCI-001462,CSF|PR.PT-1,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14a.,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-242008r922966_rule,STIG-ID|WNFWA-000029,STIG-Legacy|SV-54923,STIG-Legacy|V-17447,SWIFT-CSCv1|6.4,Vuln-ID|V-242008"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
          value_type  : POLICY_DWORD
          value_data  : 1
          reg_key     : "HKLM\System\Currentcontrolset\Services\Sharedaccess\Parameters\Firewallpolicy\Publicprofile\Logging"
          reg_item    : "LogSuccessfulConnections"
          reg_option  : CAN_NOT_BE_NULL
        </custom_item>
      </else>
    </if>

    <custom_item>
      type                 : AUDIT_POWERSHELL
      description          : "WNFWA-000100 - Inbound exceptions to the firewall on domain workstations must only allow authorized remote management hosts."
      info                 : "Allowing inbound access to domain workstations from other systems may allow lateral movement across systems if credentials are compromised. Limiting inbound connections only from authorized remote management systems will help limit this exposure."
      solution             : "Ensure firewall exceptions to inbound connections on domain workstations only allow authorized management systems and remote management hosts.

Firewall rules can be complex and should be thoroughly tested before applying in a production environment.

One method for restricting inbound connections is to only allow exceptions for a specific scope of remote IP addresses. For any inbound rules that allow connections from other systems, configure the Scope for Remote IP addresses to those of authorized management systems and remote management hosts. This may be defined as an IP address, subnet, or range. Apply the rule to all firewall profiles."
      reference            : "800-171|3.1.12,800-53|AC-17(1),800-53r5|AC-17(1),CAT|II,CCI|CCI-000067,CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|PR.AC-3,CSF|PR.PT-4,DISA_Benchmark|Windows_Firewall_with_Advanced_Security,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17(1),NESA|T5.4.4,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-242009r922967_rule,STIG-ID|WNFWA-000100,STIG-Legacy|SV-55086,STIG-Legacy|V-36440,SWIFT-CSCv1|2.6,Vuln-ID|V-242009"
      see_also             : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
      value_type           : POLICY_TEXT
      value_data           : ""
      powershell_args      : "Get-NetFirewallRule | where-object {$_.direction -eq 'inbound' -AND $_.enabled -eq 'true'} | Format-List DisplayName,Enabled,Direction"
      only_show_cmd_output : YES
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "DISA_STIG_Windows_Firewall_v2r2.audit from DISA Microsoft Windows Defender Firewall with Advanced Security v2r2 STIG"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_Defender_Firewall_V2R2_STIG.zip"
    </report>
  </else>
</if>

</group_policy>
</check_type>
